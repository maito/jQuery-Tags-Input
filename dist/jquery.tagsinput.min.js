!function(t){null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)?define(["jquery"],t):t(jQuery)}(function(r){var d=new Array,o=new Array;r.fn.doAutosize=function(t){var a=r(this).data("minwidth"),e=r(this).data("maxwidth"),i="",n=r(this),d=r("#"+r(this).data("tester_id"));i!==(i=n.val())&&(i=i.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;"),d.html(i),((t=(d=d.width())+t.comfortZone>=a?d+t.comfortZone:a)<n.width()&&a<=t||a<t&&t<e)&&n.width(t))},r.fn.resetAutosize=function(t){var a=r(this).data("minwidth")||t.minInputWidth||r(this).width(),e=r(this).data("maxwidth")||t.maxInputWidth||r(this).closest(".tagsinput").width()-t.inputPadding,i=r(this),n=r("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:i.css("fontSize"),fontFamily:i.css("fontFamily"),fontWeight:i.css("fontWeight"),letterSpacing:i.css("letterSpacing"),whiteSpace:"nowrap"}),t=r(this).attr("id")+"_autosize_tester";0<!r("#"+t).length&&(n.attr("id",t),n.appendTo("body")),i.data("minwidth",a),i.data("maxwidth",e),i.data("tester_id",t),i.css("width",a)},r.fn.addTag=function(i,n){return n=jQuery.extend({focus:!1,callback:!0},n),this.each(function(){var t,a=r(this).attr("id"),e=r(this).val().split(d[a]);if(""==e[0]&&(e=new Array),i=jQuery.trim(i),n.unique?1==(t=r(this).tagExist(i))&&r("#"+a+"_tag").addClass("not_valid"):t=!1,""!=i&&1!=t){if(n.callback&&o[a]&&o[a].onBeforeAddTag)if(!o[a].onBeforeAddTag.call(this,i))return!1;r("<span>").addClass("tag").append(r("<span>").text(i).append("&nbsp;&nbsp;"),r("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return r("#"+a).removeTag(escape(i))})).insertBefore("#"+a+"_addTag"),e.push(i),r("#"+a+"_tag").val(""),n.focus?r("#"+a+"_tag").focus():r("#"+a+"_tag").blur(),r.fn.tagsInput.updateTagsField(this,e),n.callback&&o[a]&&o[a].onAfterAddTag&&o[a].onAfterAddTag.call(this,i),o[a]&&o[a].onChange&&(t=e.length,o[a].onChange.call(this,r(this),e[t-1]))}}),!1},r.fn.removeTag=function(e){return e=unescape(e),this.each(function(){var t=r(this).attr("id"),a=r(this).val().split(d[t]);for(r("#"+t+"_tagsinput .tag").remove(),str="",i=0;i<a.length;i++)a[i]!=e&&(str=str+d[t]+a[i]);r.fn.tagsInput.importTags(this,str),o[t]&&o[t].onAfterRemoveTag&&o[t].onAfterRemoveTag.call(this,e)}),!1},r.fn.tagExist=function(t){var a=r(this).attr("id"),a=r(this).val().split(d[a]);return 0<=jQuery.inArray(t,a)},r.fn.importTags=function(t){var a=r(this).attr("id");r("#"+a+"_tagsinput .tag").remove(),r.fn.tagsInput.importTags(this,t)},r.fn.tagsInput=function(t){var n=jQuery.extend({interactive:!0,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:!1},hide:!0,delimiter:",",unique:!0,removeWithBackspace:!0,placeholderColor:"#666666",autosize:!0,comfortZone:20,inputPadding:12},t),e=0;return this.each(function(){if(void 0===r(this).attr("data-tagsinput-init")){r(this).attr("data-tagsinput-init",!0),n.hide&&r(this).hide();var i=r(this).attr("id");i&&!d[r(this).attr("id")]||(i=r(this).attr("id","tags"+(new Date).getTime()+e++).attr("id"));var t=jQuery.extend({pid:i,real_input:"#"+i,holder:"#"+i+"_tagsinput",input_wrapper:"#"+i+"_addTag",fake_input:"#"+i+"_tag"},n);d[i]=t.delimiter,(n.onAfterAddTag||n.onAfterRemoveTag||n.onChange||n.onBeforeAddTag)&&(o[i]=new Array,o[i].onAfterAddTag=n.onAfterAddTag,o[i].onAfterRemoveTag=n.onAfterRemoveTag,o[i].onChange=n.onChange,o[i].onBeforeAddTag=n.onBeforeAddTag);var a='<div id="'+i+'_tagsinput" class="tagsinput"><div id="'+i+'_addTag">';if(n.interactive&&(a=a+'<input id="'+i+'_tag" value="" data-default="'+n.defaultText+'" />'),r(a+='</div><div class="tags_clear"></div></div>').insertAfter(this),r(t.holder).css("width",n.width),r(t.holder).css("min-height",n.height),r(t.holder).css("height",n.height),""!=r(t.real_input).val()&&r.fn.tagsInput.importTags(r(t.real_input),r(t.real_input).val()),n.interactive){if(r(t.fake_input).val(r(t.fake_input).attr("data-default")),r(t.fake_input).css("color",n.placeholderColor),r(t.fake_input).resetAutosize(n),r(t.holder).bind("click",t,function(t){r(t.data.fake_input).focus()}),r(t.fake_input).bind("focus",t,function(t){r(t.data.fake_input).val()==r(t.data.fake_input).attr("data-default")&&r(t.data.fake_input).val(""),r(t.data.fake_input).css("color","#000000")}),null!=n.autocomplete_url){for(attrname in autocomplete_options={source:n.autocomplete_url},n.autocomplete)autocomplete_options[attrname]=n.autocomplete[attrname];void 0!==jQuery.Autocompleter?(r(t.fake_input).autocomplete(n.autocomplete_url,n.autocomplete),r(t.fake_input).bind("result",t,function(t,a,e){a&&r("#"+i).addTag(a[0]+"",{focus:!0,unique:n.unique})})):void 0!==jQuery.ui.autocomplete&&(r(t.fake_input).autocomplete(autocomplete_options),r(t.fake_input).bind("autocompleteselect",t,function(t,a){return r(t.data.real_input).addTag(a.item.value,{focus:!0,unique:n.unique}),!1}))}else r(t.fake_input).bind("blur",t,function(t){var a=r(this).attr("data-default");return""!=r(t.data.fake_input).val()&&r(t.data.fake_input).val()!=a?t.data.minChars<=r(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=r(t.data.fake_input).val().length)&&r(t.data.real_input).addTag(r(t.data.fake_input).val(),{focus:!0,unique:n.unique}):(r(t.data.fake_input).val(r(t.data.fake_input).attr("data-default")),r(t.data.fake_input).css("color",n.placeholderColor)),!1});r(t.fake_input).bind("keypress",t,function(t){return u(t)?(t.preventDefault(),t.data.minChars<=r(t.data.fake_input).val().length&&(!t.data.maxChars||t.data.maxChars>=r(t.data.fake_input).val().length)&&r(t.data.real_input).addTag(r(t.data.fake_input).val(),{focus:!0,unique:n.unique}),r(t.data.fake_input).resetAutosize(n),!1):void(t.data.autosize&&r(t.data.fake_input).doAutosize(n))}),t.removeWithBackspace&&r(t.fake_input).bind("keydown",function(t){var a;8==t.keyCode&&""==r(this).val()&&(t.preventDefault(),a=r(this).closest(".tagsinput").find(".tag:last").text(),t=r(this).attr("id").replace(/_tag$/,""),a=a.replace(/[\s]+x$/,""),r("#"+t).removeTag(escape(a)),r(this).trigger("focus"))}),r(t.fake_input).blur(),t.unique&&r(t.fake_input).keydown(function(t){8!=t.keyCode&&!String.fromCharCode(t.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/)||r(this).removeClass("not_valid")})}}}),this},r.fn.tagsInput.updateTagsField=function(t,a){var e=r(t).attr("id");r(t).val(a.join(d[e]))},r.fn.tagsInput.importTags=function(t,a){r(t).val("");var e=r(t).attr("id"),n=a.split(d[e]);for(i=0;i<n.length;i++)r(t).addTag(n[i],{focus:!1,callback:!1});o[e]&&o[e].onChange&&o[e].onChange.call(t,t,n[i])};var u=function(e){var i=!1;return 13==e.which||("string"==typeof e.data.delimiter?e.which==e.data.delimiter.charCodeAt(0)&&(i=!0):r.each(e.data.delimiter,function(t,a){e.which==a.charCodeAt(0)&&(i=!0)}),i)}});